
<% //console.log(`HERE ARE THE DATES I HAVE : ${dates}`) %>
<% let elevatedArray = [] %>
<% let depressedArray = [] %>
<% let irritableArray = [] %>
<% let anxiousArray = [] %>
<% let sleepArray = []%>

<% const getData = (metric, array) => {%>
    <% moods.forEach(m => { %>
        <% if (m[metric] !== null) {%>
            <% array.push(m[metric]) %>
        <% } else { %>
            <% array.push(0)%>
        <% } %>
    <% }) %>
<% } %>

<% getData('elevated', elevatedArray) %>
<% getData('depressed', depressedArray) %>
<% getData('irritable', irritableArray) %>
<% getData('anxious', anxiousArray) %>
<% getData('sleep', sleepArray) %>

<main>              
<h1>DASHBOARD</h1>

<h4>Your Week at a Glance</h4>
<canvas class="chart-view" id="elevated-chart"></canvas>
<canvas class="chart-view" id="depressed-chart"></canvas>
<canvas class="chart-view" id="irritable-chart"></canvas>
<canvas class="chart-view" id="anxious-chart"></canvas>
<canvas class="chart-view" id="sleep-chart"></canvas>

</main>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let clientDates = '<%- JSON.stringify(dates) %>';
    let clientElevated = '<%- JSON.stringify(elevatedArray) %>';
    let clientDepressed = '<%- JSON.stringify(depressedArray) %>';
    let clientIrritable = '<%- JSON.stringify(irritableArray) %>';
    let clientAnxious = '<%- JSON.stringify(anxiousArray) %>';
    let clientSleep = '<%- JSON.stringify(sleepArray) %>';

    // remove the brackets and quotes from strings and split into array
    clientDates = clientDates.replace(/[\[\]"]+/g, '').split(',');
    clientElevated = clientElevated.replace(/[\[\]"]+/g, '').split(',');
    clientDepressed = clientDepressed.replace(/[\[\]"]+/g, '').split(',');
    clientIrritable = clientIrritable.replace(/[\[\]"]+/g, '').split(',');
    clientAnxious = clientAnxious.replace(/[\[\]"]+/g, '').split(',');
    clientSleep = clientSleep.replace(/[\[\]"]+/g, '').split(',');
    
    // var ctx = document.getElementById('anxious-chart').getContext('2d');
    // var chart = new Chart(ctx, {
    //     // The type of chart we want to create
    //     type: 'line',

    //     // The data for our dataset
    //     data: {
    //         labels: clientDates,
    //         datasets: [{
    //             label: 'Anxiety',
    //             backgroundColor: 'rgb(4, 200, 214)',
    //             borderColor: 'rgb(4, 95, 214)',
    //             data: clientAnxiety
    //         }]
    //     },
    //     options: {}
    // });

    const buildChart = (elemId, data, label, backgroundRbg, borderRbg) => {
        var ctx = document.getElementById(elemId).getContext('2d')
        var chart = new Chart(ctx, {
            type: 'line',

            data: {
                labels: clientDates,
                datasets: [{
                    label: label,
                    backgroundColor: backgroundRbg,
                    borderColor: borderRbg,
                    data: data
                }]
            },
            options: {}
        })
    }
    
    buildChart('elevated-chart', clientElevated, 'Elevated Mood', 'rgb(4, 200, 214)', 'rgb(4, 95, 214)' )
    buildChart('depressed-chart', clientDepressed, 'Depression', 'rgb(4, 200, 214)', 'rgb(4, 95, 214)' )
    buildChart('irritable-chart', clientIrritable, 'Irritability', 'rgb(4, 200, 214)', 'rgb(4, 95, 214)' )
    buildChart('anxious-chart', clientAnxious, 'Anxiety', 'rgb(4, 200, 214)', 'rgb(4, 95, 214)' )
    buildChart('sleep-chart', clientSleep, 'Sleep', 'rgb(4, 200, 214)', 'rgb(4, 95, 214)' )
    
        // var chart = new Chart(ctx, {
        //     // The type of chart we want to create
        //     type: 'line',
    
        //     // The data for our dataset
        //     data: {
        //         labels: [1, 2],
        //         datasets: [{
        //             label: 'Anxiety',
        //             backgroundColor: 'rgb(255, 99, 132)',
        //             borderColor: 'rgb(255, 99, 132)',
        //             data: [0, 33, 44, 50, 10, 19, 11]
        //         }]
        //     },
    
        //     // Configuration options go here
        //     options: {}
        // });
</script>